# è‡ªåŠ¨åŒ–æµç¨‹åç§°
name: Build and Deploy Vue to GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šå½“æœ‰ä»£ç  push åˆ° main åˆ†æ”¯æ—¶ï¼Œè‡ªåŠ¨è¿è¡Œæ­¤æµç¨‹
on:
  push:
    branches:
      - main

# æƒé™è®¾ç½®ï¼šå…è®¸æ­¤æµç¨‹å‘ä½ çš„ä»“åº“ gh-pages åˆ†æ”¯å†™å…¥å†…å®¹
permissions:
  contents: write

# ä»»åŠ¡åˆ—è¡¨ï¼šè¿™é‡Œå®šä¹‰äº†æœºå™¨äººéœ€è¦åšçš„å·¥ä½œ
jobs:
  build-and-deploy:
    # è¿è¡Œç¯å¢ƒï¼šä½¿ç”¨æœ€æ–°ç‰ˆçš„ Ubuntu è™šæ‹Ÿæœº
    runs-on: ubuntu-latest

    # æ­¥éª¤åˆ—è¡¨ï¼šæŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤
    steps:
      # ç¬¬ä¸€æ­¥ï¼šæ£€å‡ºä»£ç 
      # æŠŠä½ çš„ä»“åº“ä»£ç ä¸‹è½½åˆ°è™šæ‹Ÿæœºé‡Œ
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # ç¬¬äºŒæ­¥ï¼šå®‰è£… Node.js
      # å› ä¸ºæ‰“åŒ… Vue é¡¹ç›®éœ€è¦ Node.js ç¯å¢ƒ
      - name: Setup Node.js ğŸŸ©
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…é¡¹ç›®ä¾èµ–
      # ç›¸å½“äºåœ¨è™šæ‹Ÿæœºé‡Œè¿è¡Œ npm install
      - name: Install dependencies ğŸ“¦
        run: npm install

      # ç¬¬å››æ­¥ï¼šåˆ›å»ºç”Ÿäº§ç¯å¢ƒçš„ .env æ–‡ä»¶
      # è¿™æ˜¯å…³é”®ä¸€æ­¥ï¼æˆ‘ä»¬ä¸èƒ½æŠŠç”Ÿäº§ç¯å¢ƒçš„ URL å†™åœ¨ä»£ç é‡Œ
      # ${{ secrets.VUE_APP_API_URL }} ä¼šå»è¯»å–ä½ åœ¨ GitHub ä»“åº“é‡Œè®¾ç½®çš„å®‰å…¨å¯†é’¥
      # ç¬¬å››æ­¥ï¼šåˆ›å»ºç”Ÿäº§ç¯å¢ƒçš„ .env æ–‡ä»¶
      # è¿™æ˜¯å…³é”®ä¸€æ­¥ï¼æˆ‘ä»¬ä¸èƒ½æŠŠç”Ÿäº§ç¯å¢ƒçš„ URL å†™åœ¨ä»£ç é‡Œ
      # ${{ secrets.VUE_APP_API_URL }} ä¼šå»è¯»å–ä½ åœ¨ GitHub ä»“åº“é‡Œè®¾ç½®çš„å®‰å…¨å¯†é’¥
      - name: Create .env.production file ğŸ¤«
        run: |
          echo "VUE_APP_API_URL=${{ secrets.VUE_APP_API_URL }}" > .env.production
          echo "VUE_APP_SITE_PASSWORD=${{ secrets.VUE_APP_SITE_PASSWORD }}" >> .env.production      # ç¬¬äº”æ­¥ï¼šæ‰“åŒ…æ„å»ºé¡¹ç›®
      # ç›¸å½“äºåœ¨è™šæ‹Ÿæœºé‡Œè¿è¡Œ npm run buildï¼Œä¼šç”Ÿæˆ dist æ–‡ä»¶å¤¹
      - name: Build project ğŸ—ï¸
        run: npm run build

      # ç¬¬å…­æ­¥ï¼šéƒ¨ç½²åˆ° GitHub Pages
      # ä½¿ç”¨ä¸€ä¸ªç¤¾åŒºé‡Œéå¸¸æµè¡Œçš„ Action æ¥å¤„ç†éƒ¨ç½²çš„å¤æ‚ç»†èŠ‚
      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v4
        with:
          # deploy_key æ˜¯å¦ä¸€ä¸ªå®‰å…¨å¯†é’¥ï¼Œå…è®¸è¿™ä¸ª Action å‘ä½ çš„ä»“åº“æ¨é€å†…å®¹
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
          # è¦å‘å¸ƒå“ªä¸ªæ–‡ä»¶å¤¹é‡Œçš„å†…å®¹
          publish_dir: ./dist