import{_ as O,u as P,r as v,o as q,w as F,c as l,l as o,g as y,b as k,k as L,F as p,d as m,n as U,e as x,f as $,K,I as M,h as G,L as H,j as s,D as J,m as T,t as i,R as Q}from"./index-Dop8gYHR.js";import{a as W,E as X,b as Y}from"./el-select-DacM0O0d.js";import"./el-input--AfRpvxX.js";import{E as Z}from"./el-skeleton-item-BP1FV9A5.js";import"./index-CtM-7-_7.js";const ee={class:"tag-search-view"},ae={class:"search-header-card"},te={key:0,class:"tag-cloud-viewport"},se={class:"tag-cloud-track"},le=["onClick"],oe={class:"tag-count"},ne=["onClick"],ce={class:"tag-count"},ie={class:"search-results"},re={key:0,class:"loading-container"},de={key:1},ue={key:0},ve={class:"article-grid"},ge={class:"card-cover"},pe=["src","alt"],me={key:1,class:"cover-placeholder"},_e={class:"card-body"},he={class:"card-title"},fe={class:"card-summary"},ye={class:"card-meta"},ke={class:"meta-basic-info"},Te={key:0},Ce={key:0,class:"meta-tags-list"},Se={key:0,class:"pagination-container"},we={__name:"TagSearchView",setup(Ie){const A=P(),w=M(),E=H(),r=v([]),_=v([]),u=v([]),C=v(!1),h=v([]),d=v({page:1,pageSize:10,total:0}),g=v(!0),N=async()=>{try{const a=await K();a.code===0&&(r.value=a.data)}catch(a){console.error("获取所有标签失败:",a)}},z=a=>{a?(C.value=!0,setTimeout(()=>{C.value=!1,_.value=r.value.filter(t=>t.name.toLowerCase().includes(a.toLowerCase()))},200)):_.value=[]},I=a=>{u.value.some(n=>n.id===a.id)||(u.value.push(a),b())},S=async(a=1)=>{const t=u.value.map(n=>n.id);if(t.length===0){h.value=[],d.value.total=0,g.value=!1;return}g.value=!0;try{const n={page:a,pageSize:d.value.pageSize,tagIds:t.join(",")},c=await G(n);c.code===0&&c.data&&(h.value=c.data.records,d.value.total=c.data.total,d.value.page=c.data.current)}catch(n){console.error("获取多标签文章列表失败:",n)}finally{g.value=!1}},b=()=>{const a=u.value.map(t=>t.id);E.replace({query:{tagIds:a.join(",")||void 0}}),S(1)},V=()=>{const a=w.query.tagIds||"";if(a&&r.value.length>0){const t=a.split(",").map(c=>parseInt(c,10)),n=r.value.filter(c=>t.includes(c.id));u.value=n,_.value=[...n],S()}else g.value=!1},B=a=>{S(a),window.scrollTo(0,0)},j=a=>a?a.split("T")[0]:"";return q(async()=>{await N(),V()}),F(()=>w.query.tagIds,a=>{a&&r.value.length>0&&V()},{immediate:!1}),(a,t)=>{const n=Y,c=W,D=Z,R=X;return s(),l("div",ee,[o("div",ae,[t[2]||(t[2]=o("h1",{class:"page-title"},"标签检索",-1)),t[3]||(t[3]=o("p",{class:"page-subtitle"},"选择一个或多个标签，寻找它们的交集与灵感",-1)),y(c,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"输入关键词搜索并添加标签","remote-method":z,loading:C.value,onChange:b,class:"tag-selector","value-key":"id"},{default:L(()=>[(s(!0),l(p,null,m(_.value,e=>(s(),J(n,{key:e.id,label:e.name,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),r.value.length>0?(s(),l("div",te,[o("div",se,[(s(!0),l(p,null,m(r.value,e=>(s(),l("span",{key:e.id+"-a",class:"tag-cloud-item",onClick:f=>I(e)},[T(i(e.name)+" ",1),o("span",oe,"("+i(e.articleCount)+")",1)],8,le))),128)),(s(!0),l(p,null,m(r.value,e=>(s(),l("span",{key:e.id+"-b",class:"tag-cloud-item",onClick:f=>I(e)},[T(i(e.name)+" ",1),o("span",ce,"("+i(e.articleCount)+")",1)],8,ne))),128))])])):k("",!0)]),o("div",ie,[g.value?(s(),l("div",re,[y(D,{rows:5,animated:""})])):(s(),l("div",de,[h.value.length>0?(s(),l("div",ue,[o("div",ve,[(s(!0),l(p,null,m(h.value,e=>(s(),l("div",{key:e.id,class:"article-card"},[y(x(Q),{to:{name:"articleDetail",params:{id:e.id}},class:"card-link"},{default:L(()=>[o("div",ge,[e.coverImage?(s(),l("img",{key:0,src:e.coverImage,alt:e.title,loading:"lazy"},null,8,pe)):(s(),l("div",me,[o("span",null,i(e.title.charAt(0)),1)]))]),o("div",_e,[o("h2",he,i(e.title),1),o("p",fe,i(e.summary||"暂无摘要..."),1),o("div",ye,[o("div",ke,[o("span",null,[t[4]||(t[4]=o("i",{class:"fa-regular fa-calendar-days"},null,-1)),T(" "+i(j(e.createTime)),1)]),e.categoryName?(s(),l("span",Te,[t[5]||(t[5]=o("i",{class:"fa-regular fa-folder"},null,-1)),T(" "+i(e.categoryName),1)])):k("",!0)]),e.tags&&e.tags.length?(s(),l("div",Ce,[(s(!0),l(p,null,m(e.tags,f=>(s(),l("span",{key:f.id,class:"card-tag"},"# "+i(f.name),1))),128))])):k("",!0)])])]),_:2},1032,["to"])]))),128))]),d.value.total>0?(s(),l("div",Se,[y(R,{background:"",layout:"prev, pager, next",total:d.value.total,"current-page":d.value.page,"onUpdate:currentPage":t[1]||(t[1]=e=>d.value.page=e),onCurrentChange:B},null,8,["total","current-page"])])):k("",!0)])):(s(),l("div",{key:1,class:U(["empty-container",{"dark-theme":x(A).theme==="dark"}])},t[6]||(t[6]=[$('<div class="empty-state" data-v-a7a89cc9><div class="magnifier" data-v-a7a89cc9><div class="magnifier-glass" data-v-a7a89cc9></div><div class="magnifier-handle" data-v-a7a89cc9></div></div><div class="empty-text" data-v-a7a89cc9><p data-v-a7a89cc9>没有找到相关的标签，换个关键词试试吧~</p></div></div>',1)]),2))]))])])}}},Ee=O(we,[["__scopeId","data-v-a7a89cc9"]]);export{Ee as default};
