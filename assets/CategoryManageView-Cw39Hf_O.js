import{aK as xe,x as _e,M as Q,q as ee,s as ke,c as C,j as m,b as L,l as E,n as w,e,A as T,m as X,t as de,B as we,p as Ce,C as Ie,ai as Z,P as be,aB as Re,aL as $e,aM as Ae,aN as De,aO as Fe,r as h,aP as Ye,a3 as Xe,y as k,w as he,o as Ee,aQ as G,D as ne,k as n,g as o,a2 as je,aR as He,X as Ue,a1 as Y,a0 as qe,F as J,aG as Ke,aF as We,aS as Ze,aT as Ge,a6 as Qe,aU as Je,aV as ea,d as aa,aW as ta,am as K,G as Ve,aX as sa,aY as la,af as oa,T as ze,aZ as na,U as Te,a_ as Ne,a$ as ra,an as ia,b0 as ua,_ as ca,Y as ce,a as da}from"./index-D643oS84.js";import{k as fa,v as va}from"./el-loading-Cxm_OIkI.js";import{E as ma,a as pa,b as ga}from"./el-form-item-xZXJEZBU.js";import{j as ya,q as wa,r as ba,E as ha}from"./el-input-D6tAry9l.js";import{E as W,b as _a,c as ka,a as Ca,d as Ia}from"./el-button-BlzpX08S.js";import{u as Oe}from"./index-C7dKzp0i.js";var Ea="Expected a function";function ye(d,g,l){var r=!0,i=!0;if(typeof d!="function")throw new TypeError(Ea);return xe(l)&&(r="leading"in l?!!l.leading:r,i="trailing"in l?!!l.trailing:i),ya(d,g,{leading:r,maxWait:g,trailing:i})}const La=_e({header:{type:String,default:""},footer:{type:String,default:""},bodyStyle:{type:Q([String,Object,Array]),default:""},headerClass:String,bodyClass:String,footerClass:String,shadow:{type:String,values:["always","hover","never"],default:"always"}}),Sa=ee({name:"ElCard"}),$a=ee({...Sa,props:La,setup(d){const g=ke("card");return(l,r)=>(m(),C("div",{class:w([e(g).b(),e(g).is(`${l.shadow}-shadow`)])},[l.$slots.header||l.header?(m(),C("div",{key:0,class:w([e(g).e("header"),l.headerClass])},[T(l.$slots,"header",{},()=>[X(de(l.header),1)])],2)):L("v-if",!0),E("div",{class:w([e(g).e("body"),l.bodyClass]),style:we(l.bodyStyle)},[T(l.$slots,"default")],6),l.$slots.footer||l.footer?(m(),C("div",{key:1,class:w([e(g).e("footer"),l.footerClass])},[T(l.$slots,"footer",{},()=>[X(de(l.footer),1)])],2)):L("v-if",!0)],2))}});var za=Ce($a,[["__file","card.vue"]]);const Ta=Ie(za),Na=(d,g)=>{if(!Z||!d||!g)return!1;const l=d.getBoundingClientRect();let r;return g instanceof Element?r=g.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<r.bottom&&l.bottom>r.top&&l.right>r.left&&l.left<r.right},Ra=_e({urlList:{type:Q(Array),default:()=>Re([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:Q(String)}}),Va={close:()=>!0,switch:d=>be(d),rotate:d=>be(d)},Oa=ee({name:"ElImageViewer"}),Ma=ee({...Oa,props:Ra,emits:Va,setup(d,{expose:g,emit:l}){var r;const i=d,u={CONTAIN:{name:"contain",icon:$e(De)},ORIGINAL:{name:"original",icon:$e(Ae)}};let P,N="";const{t:ae}=Oe(),c=ke("image-viewer"),{nextZIndex:R}=Fe(),S=h(),x=h([]),b=Ye(),t=h(!0),y=h(i.initialIndex),I=Xe(u.CONTAIN),f=h({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),te=h((r=i.zIndex)!=null?r:R()),j=k(()=>{const{urlList:a}=i;return a.length<=1}),A=k(()=>y.value===0),B=k(()=>y.value===i.urlList.length-1),H=k(()=>i.urlList[y.value]),se=k(()=>[c.e("btn"),c.e("prev"),c.is("disabled",!i.infinite&&A.value)]),le=k(()=>[c.e("btn"),c.e("next"),c.is("disabled",!i.infinite&&B.value)]),v=k(()=>{const{scale:a,deg:_,offsetX:p,offsetY:z,enableTransition:O}=f.value;let M=p/a,F=z/a;const oe=_*Math.PI/180,Le=Math.cos(oe),Se=Math.sin(oe);M=M*Le+F*Se,F=F*Le-p/a*Se;const ge={transform:`scale(${a}) rotate(${_}deg) translate(${M}px, ${F}px)`,transition:O?"transform .3s":""};return I.value.name===u.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),q=k(()=>`${y.value+1} / ${i.urlList.length}`);function U(){ie(),P?.(),document.body.style.overflow=N,l("close")}function re(){const a=ye(p=>{switch(p.code){case K.esc:i.closeOnPressEscape&&U();break;case K.space:V();break;case K.left:me();break;case K.up:D("zoomIn");break;case K.right:pe();break;case K.down:D("zoomOut");break}}),_=ye(p=>{const z=p.deltaY||p.deltaX;D(z<0?"zoomIn":"zoomOut",{zoomRate:i.zoomRate,enableTransition:!1})});b.run(()=>{G(document,"keydown",a),G(document,"wheel",_)})}function ie(){b.stop()}function fe(){t.value=!1}function ve(a){t.value=!1,a.target.alt=ae("el.image.error")}function s(a){if(t.value||a.button!==0||!S.value)return;f.value.enableTransition=!1;const{offsetX:_,offsetY:p}=f.value,z=a.pageX,O=a.pageY,M=ye(oe=>{f.value={...f.value,offsetX:_+oe.pageX-z,offsetY:p+oe.pageY-O}}),F=G(document,"mousemove",M);G(document,"mouseup",()=>{F()}),a.preventDefault()}function $(){f.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function V(){if(t.value)return;const a=fa(u),_=Object.values(u),p=I.value.name,O=(_.findIndex(M=>M.name===p)+1)%a.length;I.value=u[a[O]],$()}function ue(a){const _=i.urlList.length;y.value=(a+_)%_}function me(){A.value&&!i.infinite||ue(y.value-1)}function pe(){B.value&&!i.infinite||ue(y.value+1)}function D(a,_={}){if(t.value)return;const{minScale:p,maxScale:z}=i,{zoomRate:O,rotateDeg:M,enableTransition:F}={zoomRate:i.zoomRate,rotateDeg:90,enableTransition:!0,..._};switch(a){case"zoomOut":f.value.scale>p&&(f.value.scale=Number.parseFloat((f.value.scale/O).toFixed(3)));break;case"zoomIn":f.value.scale<z&&(f.value.scale=Number.parseFloat((f.value.scale*O).toFixed(3)));break;case"clockwise":f.value.deg+=M,l("rotate",f.value.deg);break;case"anticlockwise":f.value.deg-=M,l("rotate",f.value.deg);break}f.value.enableTransition=F}function Me(a){var _;((_=a.detail)==null?void 0:_.focusReason)==="pointer"&&a.preventDefault()}function Pe(){i.closeOnPressEscape&&U()}function Be(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return he(H,()=>{Ve(()=>{const a=x.value[0];a?.complete||(t.value=!0)})}),he(y,a=>{$(),l("switch",a)}),Ee(()=>{re(),P=G("wheel",Be,{passive:!1}),N=document.body.style.overflow,document.body.style.overflow="hidden"}),g({setActiveItem:ue}),(a,_)=>(m(),ne(e(ta),{to:"body",disabled:!a.teleported},{default:n(()=>[o(je,{name:"viewer-fade",appear:""},{default:n(()=>[E("div",{ref_key:"wrapper",ref:S,tabindex:-1,class:w(e(c).e("wrapper")),style:we({zIndex:te.value})},[o(e(He),{loop:"",trapped:"","focus-trap-el":S.value,"focus-start-el":"container",onFocusoutPrevented:Me,onReleaseRequested:Pe},{default:n(()=>[E("div",{class:w(e(c).e("mask")),onClick:Ue(p=>a.hideOnClickModal&&U(),["self"])},null,10,["onClick"]),L(" CLOSE "),E("span",{class:w([e(c).e("btn"),e(c).e("close")]),onClick:U},[o(e(Y),null,{default:n(()=>[o(e(qe))]),_:1})],2),L(" ARROW "),e(j)?L("v-if",!0):(m(),C(J,{key:0},[E("span",{class:w(e(se)),onClick:me},[o(e(Y),null,{default:n(()=>[o(e(Ke))]),_:1})],2),E("span",{class:w(e(le)),onClick:pe},[o(e(Y),null,{default:n(()=>[o(e(We))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(m(),C("div",{key:1,class:w([e(c).e("btn"),e(c).e("progress")])},[T(a.$slots,"progress",{activeIndex:y.value,total:a.urlList.length},()=>[X(de(e(q)),1)])],2)):L("v-if",!0),L(" ACTIONS "),E("div",{class:w([e(c).e("btn"),e(c).e("actions")])},[E("div",{class:w(e(c).e("actions__inner"))},[T(a.$slots,"toolbar",{actions:D,prev:me,next:pe,reset:V,activeIndex:y.value,setActiveItem:ue},()=>[o(e(Y),{onClick:p=>D("zoomOut")},{default:n(()=>[o(e(Ze))]),_:1},8,["onClick"]),o(e(Y),{onClick:p=>D("zoomIn")},{default:n(()=>[o(e(Ge))]),_:1},8,["onClick"]),E("i",{class:w(e(c).e("actions__divider"))},null,2),o(e(Y),{onClick:V},{default:n(()=>[(m(),ne(Qe(e(I).icon)))]),_:1}),E("i",{class:w(e(c).e("actions__divider"))},null,2),o(e(Y),{onClick:p=>D("anticlockwise")},{default:n(()=>[o(e(Je))]),_:1},8,["onClick"]),o(e(Y),{onClick:p=>D("clockwise")},{default:n(()=>[o(e(ea))]),_:1},8,["onClick"])])],2)],2),L(" CANVAS "),E("div",{class:w(e(c).e("canvas"))},[(m(!0),C(J,null,aa(a.urlList,(p,z)=>(m(),C(J,{key:z},[z===y.value?(m(),C("img",{key:0,ref_for:!0,ref:O=>x.value[z]=O,src:p,style:we(e(v)),class:w(e(c).e("img")),crossorigin:a.crossorigin,onLoad:fe,onError:ve,onMousedown:s},null,46,["src","crossorigin"])):L("v-if",!0)],64))),128))],2),T(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var Pa=Ce(Ma,[["__file","image-viewer.vue"]]);const Ba=Ie(Pa),xa=_e({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Q([String,Object])},previewSrcList:{type:Q(Array),default:()=>Re([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:Q(String)}}),Aa={load:d=>d instanceof Event,error:d=>d instanceof Event,switch:d=>be(d),close:()=>!0,show:()=>!0},Da=ee({name:"ElImage",inheritAttrs:!1}),Fa=ee({...Da,props:xa,emits:Aa,setup(d,{expose:g,emit:l}){const r=d,{t:i}=Oe(),u=ke("image"),P=sa(),N=k(()=>la(Object.entries(P).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),ae=wa({excludeListeners:!0,excludeKeys:k(()=>Object.keys(N.value))}),c=h(),R=h(!1),S=h(!0),x=h(!1),b=h(),t=h(),y=Z&&"loading"in HTMLImageElement.prototype;let I;const f=k(()=>[u.e("inner"),j.value&&u.e("preview"),S.value&&u.is("loading")]),te=k(()=>{const{fit:s}=r;return Z&&s?{objectFit:s}:{}}),j=k(()=>{const{previewSrcList:s}=r;return oa(s)&&s.length>0}),A=k(()=>{const{previewSrcList:s,initialIndex:$}=r;let V=$;return $>s.length-1&&(V=0),V}),B=k(()=>r.loading==="eager"?!1:!y&&r.loading==="lazy"||r.lazy),H=()=>{Z&&(S.value=!0,R.value=!1,c.value=r.src)};function se(s){S.value=!1,R.value=!1,l("load",s)}function le(s){S.value=!1,R.value=!0,l("error",s)}function v(){Na(b.value,t.value)&&(H(),re())}const q=ua(v,200,!0);async function U(){var s;if(!Z)return;await Ve();const{scrollContainer:$}=r;ra($)?t.value=$:ia($)&&$!==""?t.value=(s=document.querySelector($))!=null?s:void 0:b.value&&(t.value=ba(b.value)),t.value&&(I=G(t,"scroll",q),setTimeout(()=>v(),100))}function re(){!Z||!t.value||!q||(I?.(),t.value=void 0)}function ie(){j.value&&(x.value=!0,l("show"))}function fe(){x.value=!1,l("close")}function ve(s){l("switch",s)}return he(()=>r.src,()=>{B.value?(S.value=!0,R.value=!1,re(),U()):H()}),Ee(()=>{B.value?U():H()}),g({showPreview:ie}),(s,$)=>(m(),C("div",ze({ref_key:"container",ref:b},e(N),{class:[e(u).b(),s.$attrs.class]}),[R.value?T(s.$slots,"error",{key:0},()=>[E("div",{class:w(e(u).e("error"))},de(e(i)("el.image.error")),3)]):(m(),C(J,{key:1},[c.value!==void 0?(m(),C("img",ze({key:0},e(ae),{src:c.value,loading:s.loading,style:e(te),class:e(f),crossorigin:s.crossorigin,onClick:ie,onLoad:se,onError:le}),null,16,["src","loading","crossorigin"])):L("v-if",!0),S.value?(m(),C("div",{key:1,class:w(e(u).e("wrapper"))},[T(s.$slots,"placeholder",{},()=>[E("div",{class:w(e(u).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),e(j)?(m(),C(J,{key:2},[x.value?(m(),ne(e(Ba),{key:0,"z-index":s.zIndex,"initial-index":e(A),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:fe,onSwitch:ve},na({toolbar:n(V=>[T(s.$slots,"toolbar",Te(Ne(V)))]),default:n(()=>[s.$slots.viewer?(m(),C("div",{key:0},[T(s.$slots,"viewer")])):L("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:n(V=>[T(s.$slots,"progress",Te(Ne(V)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],16))}});var Ya=Ce(Fa,[["__file","image.vue"]]);const Xa=Ie(Ya),ja={class:"card-header"},Ha={key:1},Ua={__name:"CategoryManageView",setup(d){const g=h([]),l=h(!0),r=async()=>{l.value=!0;try{const b=await ce.get("/category");g.value=b.data}catch(b){W.error(b.message||"获取分类列表失败")}finally{l.value=!1}};Ee(()=>{r()});const i=h(!1),u=h({id:null,name:"",description:"",coverImage:""}),P=h(null),N=h(!1),ae=k(()=>N.value?"编辑分类":"新增分类"),c={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},R=(b,t=null)=>{N.value=b==="edit",N.value?u.value={...t}:u.value={id:null,name:"",description:"",coverImage:""},i.value=!0,P.value?.clearValidate()},S=async()=>{await P.value.validate();try{N.value?(await ce.put("/category",u.value),W.success("更新成功！")):(await ce.post("/category",u.value),W.success("新增成功！")),i.value=!1,await r()}catch(b){W.error(b.message||"操作失败")}},x=async b=>{await Ia.confirm("您确定要删除该分类吗？","温馨提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"});try{await ce.delete(`/category/${b}`),W.success("删除成功！"),await r()}catch(t){W.error(t.message||"删除失败")}};return(b,t)=>{const y=Ca,I=ka,f=Xa,te=_a,j=Ta,A=ha,B=ga,H=pa,se=ma,le=va;return m(),C(J,null,[o(j,{class:"box-card"},{header:n(()=>[E("div",ja,[t[7]||(t[7]=E("span",null,"分类管理",-1)),o(y,{type:"primary",onClick:t[0]||(t[0]=v=>R("add"))},{default:n(()=>t[6]||(t[6]=[X("新增分类")])),_:1,__:[6]})])]),default:n(()=>[da((m(),ne(te,{data:g.value,style:{width:"100%"}},{default:n(()=>[o(I,{prop:"id",label:"ID",width:"100"}),o(I,{prop:"name",label:"分类名称"}),o(I,{prop:"description",label:"描述","show-overflow-tooltip":""}),o(I,{label:"封面图预览",width:"150"},{default:n(({row:v})=>[v.coverImage?(m(),ne(f,{key:0,style:{width:"100px",height:"50px"},src:v.coverImage,"preview-src-list":[v.coverImage],fit:"cover","preview-teleported":""},null,8,["src","preview-src-list"])):(m(),C("span",Ha,"无"))]),_:1}),o(I,{prop:"createTime",label:"创建时间"}),o(I,{label:"操作",width:"150"},{default:n(({row:v})=>[o(y,{type:"primary",size:"small",onClick:q=>R("edit",v)},{default:n(()=>t[8]||(t[8]=[X("编辑")])),_:2,__:[8]},1032,["onClick"]),o(y,{type:"danger",size:"small",onClick:q=>x(v.id)},{default:n(()=>t[9]||(t[9]=[X("删除")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,l.value]])]),_:1}),o(se,{modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=v=>i.value=v),title:ae.value,width:"500px"},{footer:n(()=>[o(y,{onClick:t[4]||(t[4]=v=>i.value=!1)},{default:n(()=>t[10]||(t[10]=[X("取消")])),_:1,__:[10]}),o(y,{type:"primary",onClick:S},{default:n(()=>t[11]||(t[11]=[X("确定")])),_:1,__:[11]})]),default:n(()=>[o(H,{model:u.value,rules:c,ref_key:"formRef",ref:P,"label-width":"100px"},{default:n(()=>[o(B,{label:"分类名称",prop:"name"},{default:n(()=>[o(A,{modelValue:u.value.name,"onUpdate:modelValue":t[1]||(t[1]=v=>u.value.name=v),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),o(B,{label:"分类描述",prop:"description"},{default:n(()=>[o(A,{modelValue:u.value.description,"onUpdate:modelValue":t[2]||(t[2]=v=>u.value.description=v),type:"textarea",placeholder:"请输入分类的简短描述"},null,8,["modelValue"])]),_:1}),o(B,{label:"封面图URL",prop:"coverImage"},{default:n(()=>[o(A,{modelValue:u.value.coverImage,"onUpdate:modelValue":t[3]||(t[3]=v=>u.value.coverImage=v),placeholder:"请输入图片的网络地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}},Ja=ca(Ua,[["__scopeId","data-v-95aabf95"]]);export{Ja as default};
