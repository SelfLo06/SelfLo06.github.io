import{aJ as Be,A as _e,B as G,D as ee,E as ke,c as C,h as m,d as L,j as E,H as w,u as e,M as T,k as Y,t as de,U as we,C as Ce,P as Ie,ah as Z,J as be,aA as Oe,aK as $e,aL as xe,aM as De,aN as Fe,r as h,aO as Xe,a2 as Ye,m as k,w as he,o as Ee,aP as J,b as ne,i as n,f as o,a1 as He,aQ as je,W as Ue,a0 as X,$ as We,F as Q,aF as qe,aE as Ke,aR as Ze,aS as Je,a5 as Ge,aT as Qe,aU as ea,e as aa,aV as ta,al as q,q as Re,aW as sa,aX as la,ae as oa,N as ze,aY as na,O as Te,aZ as Ne,a_ as ra,am as ia,a$ as ua,_ as ca,X as ce,a as da}from"./index-D_GpiMOx.js";import{k as fa,v as va}from"./el-loading-B9tntWcG.js";import{E as ma,a as pa,b as ga}from"./el-form-item-1V-caV9k.js";import{j as ya,q as wa,r as ba,E as ha}from"./el-input-5_IEG6rF.js";import{E as K,b as _a,c as ka,a as Ca,d as Ia}from"./el-button-CCHQcvmG.js";import{u as Ve}from"./index-DK1Sx-3r.js";var Ea="Expected a function";function ye(d,g,l){var r=!0,i=!0;if(typeof d!="function")throw new TypeError(Ea);return Be(l)&&(r="leading"in l?!!l.leading:r,i="trailing"in l?!!l.trailing:i),ya(d,g,{leading:r,maxWait:g,trailing:i})}const La=_e({header:{type:String,default:""},footer:{type:String,default:""},bodyStyle:{type:G([String,Object,Array]),default:""},headerClass:String,bodyClass:String,footerClass:String,shadow:{type:String,values:["always","hover","never"],default:"always"}}),Sa=ee({name:"ElCard"}),$a=ee({...Sa,props:La,setup(d){const g=ke("card");return(l,r)=>(m(),C("div",{class:w([e(g).b(),e(g).is(`${l.shadow}-shadow`)])},[l.$slots.header||l.header?(m(),C("div",{key:0,class:w([e(g).e("header"),l.headerClass])},[T(l.$slots,"header",{},()=>[Y(de(l.header),1)])],2)):L("v-if",!0),E("div",{class:w([e(g).e("body"),l.bodyClass]),style:we(l.bodyStyle)},[T(l.$slots,"default")],6),l.$slots.footer||l.footer?(m(),C("div",{key:1,class:w([e(g).e("footer"),l.footerClass])},[T(l.$slots,"footer",{},()=>[Y(de(l.footer),1)])],2)):L("v-if",!0)],2))}});var za=Ce($a,[["__file","card.vue"]]);const Ta=Ie(za),Na=(d,g)=>{if(!Z||!d||!g)return!1;const l=d.getBoundingClientRect();let r;return g instanceof Element?r=g.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<r.bottom&&l.bottom>r.top&&l.right>r.left&&l.left<r.right},Oa=_e({urlList:{type:G(Array),default:()=>Oe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:G(String)}}),Ra={close:()=>!0,switch:d=>be(d),rotate:d=>be(d)},Va=ee({name:"ElImageViewer"}),Ma=ee({...Va,props:Oa,emits:Ra,setup(d,{expose:g,emit:l}){var r;const i=d,u={CONTAIN:{name:"contain",icon:$e(De)},ORIGINAL:{name:"original",icon:$e(xe)}};let P,N="";const{t:ae}=Ve(),c=ke("image-viewer"),{nextZIndex:O}=Fe(),S=h(),B=h([]),b=Xe(),t=h(!0),y=h(i.initialIndex),I=Ye(u.CONTAIN),f=h({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),te=h((r=i.zIndex)!=null?r:O()),H=k(()=>{const{urlList:a}=i;return a.length<=1}),x=k(()=>y.value===0),A=k(()=>y.value===i.urlList.length-1),j=k(()=>i.urlList[y.value]),se=k(()=>[c.e("btn"),c.e("prev"),c.is("disabled",!i.infinite&&x.value)]),le=k(()=>[c.e("btn"),c.e("next"),c.is("disabled",!i.infinite&&A.value)]),v=k(()=>{const{scale:a,deg:_,offsetX:p,offsetY:z,enableTransition:V}=f.value;let M=p/a,F=z/a;const oe=_*Math.PI/180,Le=Math.cos(oe),Se=Math.sin(oe);M=M*Le+F*Se,F=F*Le-p/a*Se;const ge={transform:`scale(${a}) rotate(${_}deg) translate(${M}px, ${F}px)`,transition:V?"transform .3s":""};return I.value.name===u.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),W=k(()=>`${y.value+1} / ${i.urlList.length}`);function U(){ie(),P?.(),document.body.style.overflow=N,l("close")}function re(){const a=ye(p=>{switch(p.code){case q.esc:i.closeOnPressEscape&&U();break;case q.space:R();break;case q.left:me();break;case q.up:D("zoomIn");break;case q.right:pe();break;case q.down:D("zoomOut");break}}),_=ye(p=>{const z=p.deltaY||p.deltaX;D(z<0?"zoomIn":"zoomOut",{zoomRate:i.zoomRate,enableTransition:!1})});b.run(()=>{J(document,"keydown",a),J(document,"wheel",_)})}function ie(){b.stop()}function fe(){t.value=!1}function ve(a){t.value=!1,a.target.alt=ae("el.image.error")}function s(a){if(t.value||a.button!==0||!S.value)return;f.value.enableTransition=!1;const{offsetX:_,offsetY:p}=f.value,z=a.pageX,V=a.pageY,M=ye(oe=>{f.value={...f.value,offsetX:_+oe.pageX-z,offsetY:p+oe.pageY-V}}),F=J(document,"mousemove",M);J(document,"mouseup",()=>{F()}),a.preventDefault()}function $(){f.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function R(){if(t.value)return;const a=fa(u),_=Object.values(u),p=I.value.name,V=(_.findIndex(M=>M.name===p)+1)%a.length;I.value=u[a[V]],$()}function ue(a){const _=i.urlList.length;y.value=(a+_)%_}function me(){x.value&&!i.infinite||ue(y.value-1)}function pe(){A.value&&!i.infinite||ue(y.value+1)}function D(a,_={}){if(t.value)return;const{minScale:p,maxScale:z}=i,{zoomRate:V,rotateDeg:M,enableTransition:F}={zoomRate:i.zoomRate,rotateDeg:90,enableTransition:!0,..._};switch(a){case"zoomOut":f.value.scale>p&&(f.value.scale=Number.parseFloat((f.value.scale/V).toFixed(3)));break;case"zoomIn":f.value.scale<z&&(f.value.scale=Number.parseFloat((f.value.scale*V).toFixed(3)));break;case"clockwise":f.value.deg+=M,l("rotate",f.value.deg);break;case"anticlockwise":f.value.deg-=M,l("rotate",f.value.deg);break}f.value.enableTransition=F}function Me(a){var _;((_=a.detail)==null?void 0:_.focusReason)==="pointer"&&a.preventDefault()}function Pe(){i.closeOnPressEscape&&U()}function Ae(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return he(j,()=>{Re(()=>{const a=B.value[0];a?.complete||(t.value=!0)})}),he(y,a=>{$(),l("switch",a)}),Ee(()=>{re(),P=J("wheel",Ae,{passive:!1}),N=document.body.style.overflow,document.body.style.overflow="hidden"}),g({setActiveItem:ue}),(a,_)=>(m(),ne(e(ta),{to:"body",disabled:!a.teleported},{default:n(()=>[o(He,{name:"viewer-fade",appear:""},{default:n(()=>[E("div",{ref_key:"wrapper",ref:S,tabindex:-1,class:w(e(c).e("wrapper")),style:we({zIndex:te.value})},[o(e(je),{loop:"",trapped:"","focus-trap-el":S.value,"focus-start-el":"container",onFocusoutPrevented:Me,onReleaseRequested:Pe},{default:n(()=>[E("div",{class:w(e(c).e("mask")),onClick:Ue(p=>a.hideOnClickModal&&U(),["self"])},null,10,["onClick"]),L(" CLOSE "),E("span",{class:w([e(c).e("btn"),e(c).e("close")]),onClick:U},[o(e(X),null,{default:n(()=>[o(e(We))]),_:1})],2),L(" ARROW "),e(H)?L("v-if",!0):(m(),C(Q,{key:0},[E("span",{class:w(e(se)),onClick:me},[o(e(X),null,{default:n(()=>[o(e(qe))]),_:1})],2),E("span",{class:w(e(le)),onClick:pe},[o(e(X),null,{default:n(()=>[o(e(Ke))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(m(),C("div",{key:1,class:w([e(c).e("btn"),e(c).e("progress")])},[T(a.$slots,"progress",{activeIndex:y.value,total:a.urlList.length},()=>[Y(de(e(W)),1)])],2)):L("v-if",!0),L(" ACTIONS "),E("div",{class:w([e(c).e("btn"),e(c).e("actions")])},[E("div",{class:w(e(c).e("actions__inner"))},[T(a.$slots,"toolbar",{actions:D,prev:me,next:pe,reset:R,activeIndex:y.value,setActiveItem:ue},()=>[o(e(X),{onClick:p=>D("zoomOut")},{default:n(()=>[o(e(Ze))]),_:1},8,["onClick"]),o(e(X),{onClick:p=>D("zoomIn")},{default:n(()=>[o(e(Je))]),_:1},8,["onClick"]),E("i",{class:w(e(c).e("actions__divider"))},null,2),o(e(X),{onClick:R},{default:n(()=>[(m(),ne(Ge(e(I).icon)))]),_:1}),E("i",{class:w(e(c).e("actions__divider"))},null,2),o(e(X),{onClick:p=>D("anticlockwise")},{default:n(()=>[o(e(Qe))]),_:1},8,["onClick"]),o(e(X),{onClick:p=>D("clockwise")},{default:n(()=>[o(e(ea))]),_:1},8,["onClick"])])],2)],2),L(" CANVAS "),E("div",{class:w(e(c).e("canvas"))},[(m(!0),C(Q,null,aa(a.urlList,(p,z)=>(m(),C(Q,{key:z},[z===y.value?(m(),C("img",{key:0,ref_for:!0,ref:V=>B.value[z]=V,src:p,style:we(e(v)),class:w(e(c).e("img")),crossorigin:a.crossorigin,onLoad:fe,onError:ve,onMousedown:s},null,46,["src","crossorigin"])):L("v-if",!0)],64))),128))],2),T(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var Pa=Ce(Ma,[["__file","image-viewer.vue"]]);const Aa=Ie(Pa),Ba=_e({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:G([String,Object])},previewSrcList:{type:G(Array),default:()=>Oe([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:G(String)}}),xa={load:d=>d instanceof Event,error:d=>d instanceof Event,switch:d=>be(d),close:()=>!0,show:()=>!0},Da=ee({name:"ElImage",inheritAttrs:!1}),Fa=ee({...Da,props:Ba,emits:xa,setup(d,{expose:g,emit:l}){const r=d,{t:i}=Ve(),u=ke("image"),P=sa(),N=k(()=>la(Object.entries(P).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),ae=wa({excludeListeners:!0,excludeKeys:k(()=>Object.keys(N.value))}),c=h(),O=h(!1),S=h(!0),B=h(!1),b=h(),t=h(),y=Z&&"loading"in HTMLImageElement.prototype;let I;const f=k(()=>[u.e("inner"),H.value&&u.e("preview"),S.value&&u.is("loading")]),te=k(()=>{const{fit:s}=r;return Z&&s?{objectFit:s}:{}}),H=k(()=>{const{previewSrcList:s}=r;return oa(s)&&s.length>0}),x=k(()=>{const{previewSrcList:s,initialIndex:$}=r;let R=$;return $>s.length-1&&(R=0),R}),A=k(()=>r.loading==="eager"?!1:!y&&r.loading==="lazy"||r.lazy),j=()=>{Z&&(S.value=!0,O.value=!1,c.value=r.src)};function se(s){S.value=!1,O.value=!1,l("load",s)}function le(s){S.value=!1,O.value=!0,l("error",s)}function v(){Na(b.value,t.value)&&(j(),re())}const W=ua(v,200,!0);async function U(){var s;if(!Z)return;await Re();const{scrollContainer:$}=r;ra($)?t.value=$:ia($)&&$!==""?t.value=(s=document.querySelector($))!=null?s:void 0:b.value&&(t.value=ba(b.value)),t.value&&(I=J(t,"scroll",W),setTimeout(()=>v(),100))}function re(){!Z||!t.value||!W||(I?.(),t.value=void 0)}function ie(){H.value&&(B.value=!0,l("show"))}function fe(){B.value=!1,l("close")}function ve(s){l("switch",s)}return he(()=>r.src,()=>{A.value?(S.value=!0,O.value=!1,re(),U()):j()}),Ee(()=>{A.value?U():j()}),g({showPreview:ie}),(s,$)=>(m(),C("div",ze({ref_key:"container",ref:b},e(N),{class:[e(u).b(),s.$attrs.class]}),[O.value?T(s.$slots,"error",{key:0},()=>[E("div",{class:w(e(u).e("error"))},de(e(i)("el.image.error")),3)]):(m(),C(Q,{key:1},[c.value!==void 0?(m(),C("img",ze({key:0},e(ae),{src:c.value,loading:s.loading,style:e(te),class:e(f),crossorigin:s.crossorigin,onClick:ie,onLoad:se,onError:le}),null,16,["src","loading","crossorigin"])):L("v-if",!0),S.value?(m(),C("div",{key:1,class:w(e(u).e("wrapper"))},[T(s.$slots,"placeholder",{},()=>[E("div",{class:w(e(u).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),e(H)?(m(),C(Q,{key:2},[B.value?(m(),ne(e(Aa),{key:0,"z-index":s.zIndex,"initial-index":e(x),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:fe,onSwitch:ve},na({toolbar:n(R=>[T(s.$slots,"toolbar",Te(Ne(R)))]),default:n(()=>[s.$slots.viewer?(m(),C("div",{key:0},[T(s.$slots,"viewer")])):L("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:n(R=>[T(s.$slots,"progress",Te(Ne(R)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],16))}});var Xa=Ce(Fa,[["__file","image.vue"]]);const Ya=Ie(Xa),Ha={class:"card-header"},ja={key:1},Ua={__name:"CategoryManageView",setup(d){const g=h([]),l=h(!0),r=async()=>{l.value=!0;try{const b=await ce.get("/category");g.value=b.data}catch(b){K.error(b.message||"获取分类列表失败")}finally{l.value=!1}};Ee(()=>{r()});const i=h(!1),u=h({id:null,name:"",description:"",coverImage:""}),P=h(null),N=h(!1),ae=k(()=>N.value?"编辑分类":"新增分类"),c={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},O=(b,t=null)=>{N.value=b==="edit",N.value?u.value={...t}:u.value={id:null,name:"",description:"",coverImage:""},i.value=!0,P.value?.clearValidate()},S=async()=>{await P.value.validate();try{N.value?(await ce.put("/category",u.value),K.success("更新成功！")):(await ce.post("/category",u.value),K.success("新增成功！")),i.value=!1,await r()}catch(b){K.error(b.message||"操作失败")}},B=async b=>{await Ia.confirm("您确定要删除该分类吗？","温馨提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"});try{await ce.delete(`/category/${b}`),K.success("删除成功！"),await r()}catch(t){K.error(t.message||"删除失败")}};return(b,t)=>{const y=Ca,I=ka,f=Ya,te=_a,H=Ta,x=ha,A=ga,j=pa,se=ma,le=va;return m(),C(Q,null,[o(H,{class:"box-card"},{header:n(()=>[E("div",Ha,[t[7]||(t[7]=E("span",null,"分类管理",-1)),o(y,{type:"primary",onClick:t[0]||(t[0]=v=>O("add"))},{default:n(()=>t[6]||(t[6]=[Y("新增分类")])),_:1,__:[6]})])]),default:n(()=>[da((m(),ne(te,{data:g.value,style:{width:"100%"}},{default:n(()=>[o(I,{prop:"id",label:"ID",width:"100"}),o(I,{prop:"name",label:"分类名称"}),o(I,{prop:"description",label:"描述","show-overflow-tooltip":""}),o(I,{label:"封面图预览",width:"150"},{default:n(({row:v})=>[v.coverImage?(m(),ne(f,{key:0,style:{width:"100px",height:"50px"},src:v.coverImage,"preview-src-list":[v.coverImage],fit:"cover","preview-teleported":""},null,8,["src","preview-src-list"])):(m(),C("span",ja,"无"))]),_:1}),o(I,{prop:"createTime",label:"创建时间"}),o(I,{label:"操作",width:"150"},{default:n(({row:v})=>[o(y,{type:"primary",size:"small",onClick:W=>O("edit",v)},{default:n(()=>t[8]||(t[8]=[Y("编辑")])),_:2,__:[8]},1032,["onClick"]),o(y,{type:"danger",size:"small",onClick:W=>B(v.id)},{default:n(()=>t[9]||(t[9]=[Y("删除")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,l.value]])]),_:1}),o(se,{modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=v=>i.value=v),title:ae.value,width:"500px"},{footer:n(()=>[o(y,{onClick:t[4]||(t[4]=v=>i.value=!1)},{default:n(()=>t[10]||(t[10]=[Y("取消")])),_:1,__:[10]}),o(y,{type:"primary",onClick:S},{default:n(()=>t[11]||(t[11]=[Y("确定")])),_:1,__:[11]})]),default:n(()=>[o(j,{model:u.value,rules:c,ref_key:"formRef",ref:P,"label-width":"100px"},{default:n(()=>[o(A,{label:"分类名称",prop:"name"},{default:n(()=>[o(x,{modelValue:u.value.name,"onUpdate:modelValue":t[1]||(t[1]=v=>u.value.name=v),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),o(A,{label:"分类描述",prop:"description"},{default:n(()=>[o(x,{modelValue:u.value.description,"onUpdate:modelValue":t[2]||(t[2]=v=>u.value.description=v),type:"textarea",placeholder:"请输入分类的简短描述"},null,8,["modelValue"])]),_:1}),o(A,{label:"封面图URL",prop:"coverImage"},{default:n(()=>[o(x,{modelValue:u.value.coverImage,"onUpdate:modelValue":t[3]||(t[3]=v=>u.value.coverImage=v),placeholder:"请输入图片的网络地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}},Qa=ca(Ua,[["__scopeId","data-v-95aabf95"]]);export{Qa as default};
