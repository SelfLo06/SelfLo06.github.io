import{_ as O,u as P,r as v,o as q,w as F,c as l,k as o,g as y,b as k,j as V,F as m,d as p,n as U,e as L,f as $,K,I as M,h as G,L as H,i as s,C as J,l as b,t as c,R as Q}from"./index-BZHSFVTZ.js";import{a as W,E as X,b as Y}from"./el-select-BpUJtraX.js";import"./el-input-DcdFPbl3.js";import{E as Z}from"./el-skeleton-item-DneFXuxG.js";import"./index-egL024J-.js";const ee={class:"tag-search-view"},ae={class:"search-header-card"},te={key:0,class:"tag-cloud-viewport"},se={class:"tag-cloud-track"},le=["onClick"],oe={class:"tag-count"},ne=["onClick"],ie={class:"tag-count"},ce={class:"search-results"},re={key:0,class:"loading-container"},de={key:1},ue={key:0},ve={class:"article-grid"},ge={class:"card-cover"},me=["src","alt"],pe={key:1,class:"cover-placeholder"},_e={class:"card-body"},he={class:"card-title"},fe={class:"card-summary"},ye={class:"card-meta"},ke={class:"meta-basic-info"},be={key:0},Ce={key:0,class:"meta-tags-list"},Te={key:0,class:"pagination-container"},Se={__name:"TagSearchView",setup(we){const x=P(),S=M(),A=H(),r=v([]),_=v([]),u=v([]),C=v(!1),h=v([]),d=v({pageNum:1,pageSize:10,total:0}),g=v(!0),E=async()=>{try{const a=await K();a.code===0&&(r.value=a.data)}catch(a){console.error("获取所有标签失败:",a)}},z=a=>{a?(C.value=!0,setTimeout(()=>{C.value=!1,_.value=r.value.filter(t=>t.name.toLowerCase().includes(a.toLowerCase()))},200)):_.value=[]},w=a=>{u.value.some(n=>n.id===a.id)||(u.value.push(a),I())},T=async(a=1)=>{const t=u.value.map(n=>n.id);if(t.length===0){h.value=[],d.value.total=0,g.value=!1;return}g.value=!0;try{const n={page:a,pageSize:d.value.pageSize,tagIds:t.join(",")},i=await G(n);i.code===0&&i.data&&(h.value=i.data.records,d.value.total=i.data.total,d.value.pageNum=i.data.current)}catch(n){console.error("获取多标签文章列表失败:",n)}finally{g.value=!1}},I=()=>{const a=u.value.map(t=>t.id);A.replace({query:{tagIds:a.join(",")||void 0}}),T(1)},N=()=>{const a=S.query.tagIds||"";if(a&&r.value.length>0){const t=a.split(",").map(i=>parseInt(i,10)),n=r.value.filter(i=>t.includes(i.id));u.value=n,_.value=[...n],T()}else g.value=!1},B=a=>{T(a),window.scrollTo(0,0)},j=a=>a?a.split("T")[0]:"";return q(async()=>{await E(),N()}),F(()=>S.query.tagIds,a=>{a&&r.value.length>0&&N()},{immediate:!1}),(a,t)=>{const n=Y,i=W,R=Z,D=X;return s(),l("div",ee,[o("div",ae,[t[2]||(t[2]=o("h1",{class:"page-title"},"标签检索",-1)),t[3]||(t[3]=o("p",{class:"page-subtitle"},"选择一个或多个标签，寻找它们的交集与灵感",-1)),y(i,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"输入关键词搜索并添加标签","remote-method":z,loading:C.value,onChange:I,class:"tag-selector","value-key":"id"},{default:V(()=>[(s(!0),l(m,null,p(_.value,e=>(s(),J(n,{key:e.id,label:e.name,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),r.value.length>0?(s(),l("div",te,[o("div",se,[(s(!0),l(m,null,p(r.value,e=>(s(),l("span",{key:e.id+"-a",class:"tag-cloud-item",onClick:f=>w(e)},[b(c(e.name)+" ",1),o("span",oe,"("+c(e.articleCount)+")",1)],8,le))),128)),(s(!0),l(m,null,p(r.value,e=>(s(),l("span",{key:e.id+"-b",class:"tag-cloud-item",onClick:f=>w(e)},[b(c(e.name)+" ",1),o("span",ie,"("+c(e.articleCount)+")",1)],8,ne))),128))])])):k("",!0)]),o("div",ce,[g.value?(s(),l("div",re,[y(R,{rows:5,animated:""})])):(s(),l("div",de,[h.value.length>0?(s(),l("div",ue,[o("div",ve,[(s(!0),l(m,null,p(h.value,e=>(s(),l("div",{key:e.id,class:"article-card"},[y(L(Q),{to:{name:"articleDetail",params:{id:e.id}},class:"card-link"},{default:V(()=>[o("div",ge,[e.coverImage?(s(),l("img",{key:0,src:e.coverImage,alt:e.title,loading:"lazy"},null,8,me)):(s(),l("div",pe,[o("span",null,c(e.title.charAt(0)),1)]))]),o("div",_e,[o("h2",he,c(e.title),1),o("p",fe,c(e.summary||"暂无摘要..."),1),o("div",ye,[o("div",ke,[o("span",null,[t[4]||(t[4]=o("i",{class:"fa-regular fa-calendar-days"},null,-1)),b(" "+c(j(e.createTime)),1)]),e.categoryName?(s(),l("span",be,[t[5]||(t[5]=o("i",{class:"fa-regular fa-folder"},null,-1)),b(" "+c(e.categoryName),1)])):k("",!0)]),e.tags&&e.tags.length?(s(),l("div",Ce,[(s(!0),l(m,null,p(e.tags,f=>(s(),l("span",{key:f.id,class:"card-tag"},"# "+c(f.name),1))),128))])):k("",!0)])])]),_:2},1032,["to"])]))),128))]),d.value.total>0?(s(),l("div",Te,[y(D,{background:"",layout:"prev, pager, next",total:d.value.total,"current-page":d.value.pageNum,"onUpdate:currentPage":t[1]||(t[1]=e=>d.value.pageNum=e),onCurrentChange:B},null,8,["total","current-page"])])):k("",!0)])):(s(),l("div",{key:1,class:U(["empty-container",{"dark-theme":L(x).theme==="dark"}])},t[6]||(t[6]=[$('<div class="empty-state" data-v-0e35bc25><div class="magnifier" data-v-0e35bc25><div class="magnifier-glass" data-v-0e35bc25></div><div class="magnifier-handle" data-v-0e35bc25></div></div><div class="empty-text" data-v-0e35bc25><p data-v-0e35bc25>没有找到相关的标签，换个关键词试试吧~</p></div></div>',1)]),2))]))])])}}},Ae=O(Se,[["__scopeId","data-v-0e35bc25"]]);export{Ae as default};
