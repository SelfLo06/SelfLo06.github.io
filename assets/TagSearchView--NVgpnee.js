import{_ as O,r as v,o as P,w as q,c as l,j as o,f,d as k,i as N,F as p,e as _,b as V,y as F,v as U,g as $,z as M,h as s,k as T,t as i,u as G,R as H}from"./index-DsICqsk7.js";import{E as J}from"./el-empty-CsX5tvCn.js";import{a as K,E as Q,b as W}from"./el-select-B2k7X12i.js";import"./el-input-CcYOo_UG.js";import{E as X}from"./el-skeleton-item-BwbxUraW.js";import"./index-D7v2wboa.js";const Y={class:"tag-search-view"},Z={class:"search-header-card"},ee={key:0,class:"tag-cloud-viewport"},ae={class:"tag-cloud-track"},te=["onClick"],se={class:"tag-count"},le=["onClick"],oe={class:"tag-count"},ne={class:"search-results"},ce={key:0,class:"loading-container"},ie={key:1},re={key:0},de={class:"article-grid"},ue={class:"card-cover"},ve=["src","alt"],ge={key:1,class:"cover-placeholder"},pe={class:"card-body"},_e={class:"card-title"},me={class:"card-summary"},he={class:"card-meta"},ye={class:"meta-basic-info"},fe={key:0},ke={key:0,class:"meta-tags-list"},Te={key:0,class:"pagination-container"},we={__name:"TagSearchView",setup(Ce){const S=U(),A=M(),r=v([]),m=v([]),u=v([]),w=v(!1),h=v([]),d=v({pageNum:1,pageSize:10,total:0}),g=v(!0),L=async()=>{try{const a=await F();a.code===0&&(r.value=a.data)}catch(a){console.error("获取所有标签失败:",a)}},x=a=>{a?(w.value=!0,setTimeout(()=>{w.value=!1,m.value=r.value.filter(t=>t.name.toLowerCase().includes(a.toLowerCase()))},200)):m.value=[]},b=a=>{u.value.some(n=>n.id===a.id)||(u.value.push(a),I())},C=async(a=1)=>{const t=u.value.map(n=>n.id);if(t.length===0){h.value=[],d.value.total=0,g.value=!1;return}g.value=!0;try{const n={page:a,pageSize:d.value.pageSize,tagIds:t.join(",")},c=await $(n);c.code===0&&c.data&&(h.value=c.data.records,d.value.total=c.data.total,d.value.pageNum=c.data.current)}catch(n){console.error("获取多标签文章列表失败:",n)}finally{g.value=!1}},I=()=>{const a=u.value.map(t=>t.id);A.replace({query:{tagIds:a.join(",")||void 0}}),C(1)},E=()=>{const a=S.query.tagIds||"";if(a&&r.value.length>0){const t=a.split(",").map(c=>parseInt(c,10)),n=r.value.filter(c=>t.includes(c.id));u.value=n,m.value=[...n],C()}else g.value=!1},z=a=>{C(a),window.scrollTo(0,0)},B=a=>a?a.split("T")[0]:"";return P(async()=>{await L(),E()}),q(()=>S.query.tagIds,a=>{a&&r.value.length>0&&E()},{immediate:!1}),(a,t)=>{const n=W,c=K,j=X,R=Q,D=J;return s(),l("div",Y,[o("div",Z,[t[2]||(t[2]=o("h1",{class:"page-title"},"标签检索",-1)),t[3]||(t[3]=o("p",{class:"page-subtitle"},"选择一个或多个标签，寻找它们的交集与灵感",-1)),f(c,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"输入关键词搜索并添加标签","remote-method":x,loading:w.value,onChange:I,class:"tag-selector","value-key":"id"},{default:N(()=>[(s(!0),l(p,null,_(m.value,e=>(s(),V(n,{key:e.id,label:e.name,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),r.value.length>0?(s(),l("div",ee,[o("div",ae,[(s(!0),l(p,null,_(r.value,e=>(s(),l("span",{key:e.id+"-a",class:"tag-cloud-item",onClick:y=>b(e)},[T(i(e.name)+" ",1),o("span",se,"("+i(e.articleCount)+")",1)],8,te))),128)),(s(!0),l(p,null,_(r.value,e=>(s(),l("span",{key:e.id+"-b",class:"tag-cloud-item",onClick:y=>b(e)},[T(i(e.name)+" ",1),o("span",oe,"("+i(e.articleCount)+")",1)],8,le))),128))])])):k("",!0)]),o("div",ne,[g.value?(s(),l("div",ce,[f(j,{rows:5,animated:""})])):(s(),l("div",ie,[h.value.length>0?(s(),l("div",re,[o("div",de,[(s(!0),l(p,null,_(h.value,e=>(s(),l("div",{key:e.id,class:"article-card"},[f(G(H),{to:{name:"articleDetail",params:{id:e.id}},class:"card-link"},{default:N(()=>[o("div",ue,[e.coverImage?(s(),l("img",{key:0,src:e.coverImage,alt:e.title,loading:"lazy"},null,8,ve)):(s(),l("div",ge,[o("span",null,i(e.title.charAt(0)),1)]))]),o("div",pe,[o("h2",_e,i(e.title),1),o("p",me,i(e.summary||"暂无摘要..."),1),o("div",he,[o("div",ye,[o("span",null,[t[4]||(t[4]=o("i",{class:"fa-regular fa-calendar-days"},null,-1)),T(" "+i(B(e.createTime)),1)]),e.categoryName?(s(),l("span",fe,[t[5]||(t[5]=o("i",{class:"fa-regular fa-folder"},null,-1)),T(" "+i(e.categoryName),1)])):k("",!0)]),e.tags&&e.tags.length?(s(),l("div",ke,[(s(!0),l(p,null,_(e.tags,y=>(s(),l("span",{key:y.id,class:"card-tag"},"# "+i(y.name),1))),128))])):k("",!0)])])]),_:2},1032,["to"])]))),128))]),d.value.total>0?(s(),l("div",Te,[f(R,{background:"",layout:"prev, pager, next",total:d.value.total,"current-page":d.value.pageNum,"onUpdate:currentPage":t[1]||(t[1]=e=>d.value.pageNum=e),onCurrentChange:z},null,8,["total","current-page"])])):k("",!0)])):(s(),V(D,{key:1,description:"暂无满足所有已选标签的文章"}))]))])])}}},Ae=O(we,[["__scopeId","data-v-c8579a3e"]]);export{Ae as default};
